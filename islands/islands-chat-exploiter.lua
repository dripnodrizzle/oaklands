-- Islands Chat & Invite Exploiter
-- Auto-accept invites, spam invites, and chat manipulation

print("Islands Chat Exploiter Loading...")

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local Player = Players.LocalPlayer

-- =====================================================
-- CHAT SERVICE FINDER
-- =====================================================

local ChatServiceFinder = {}
ChatServiceFinder.chatService = nil

function ChatServiceFinder.findChatService()
    pcall(function()
        -- Look for client-chat-service in LocalPlayer
        local chatScript = Player:FindFirstChild("client-chat-service")
        
        if chatScript then
            print("âœ“ Found client-chat-service script")
        end
        
        -- Try to require the ChatService module
        local RuntimeLib = require(ReplicatedStorage.rbxts_include.RuntimeLib)
        
        -- The service should be accessible through imports
        pcall(function()
            local chatModule = RuntimeLib.import(chatScript, chatScript.Parent, "chat", "client-chat-service")
            if chatModule and chatModule.ClientChatService then
                ChatServiceFinder.chatService = chatModule.ClientChatService
                print("âœ“ Found ClientChatService")
                return true
            end
        end)
    end)
end

-- =====================================================
-- PLAYER LIST INTERCEPTOR
-- =====================================================

local PlayerListInterceptor = {}
PlayerListInterceptor.players = {}
PlayerListInterceptor.monitoring = false

function PlayerListInterceptor.hookFetchPlayers()
    pcall(function()
        local RuntimeLib = require(ReplicatedStorage.rbxts_include.RuntimeLib)
        local NetworkService = RuntimeLib.import(nil, ReplicatedStorage, "TS", "network", "network-service").NetworkService
        local ClientRequestId = RuntimeLib.import(nil, ReplicatedStorage, "TS", "event", "client-request-id").ClientRequestId
        
        if NetworkService and ClientRequestId then
            print("âœ“ Found NetworkService and ClientRequestId")
            
            -- Hook sendClientRequest to intercept CHAT_PLAYER_LIST requests
            local originalSendRequest = NetworkService.sendClientRequest
            
            NetworkService.sendClientRequest = function(self, requestId, data)
                if requestId == ClientRequestId.CHAT_PLAYER_LIST then
                    print("ðŸ“‹ Intercepted CHAT_PLAYER_LIST request")
                    
                    local result = originalSendRequest(self, requestId, data)
                    
                    -- Log the response
                    result:andThen(function(response)
                        if response and response.players then
                            PlayerListInterceptor.players = response.players
                            print(string.format("âœ“ Received %d players", #response.players))
                            
                            for i, player in ipairs(response.players) do
                                print(string.format("  [%d] %s", i, player.name or tostring(player)))
                            end
                        end
                    end)
                    
                    return result
                end
                
                return originalSendRequest(self, requestId, data)
            end
            
            print("âœ“ Hooked NetworkService.sendClientRequest")
        end
    end)
end

function PlayerListInterceptor.getPlayers()
    return PlayerListInterceptor.players
end

function PlayerListInterceptor.dumpPlayers()
    print("\n=== Chat Players ===")
    for i, player in ipairs(PlayerListInterceptor.players) do
        print(string.format("%d. %s", i, tostring(player.name or player)))
    end
end

-- =====================================================
-- INVITE INTERCEPTOR
-- =====================================================

local InviteInterceptor = {}
InviteInterceptor.invites = {}
InviteInterceptor.autoAccept = false
InviteInterceptor.autoDecline = false

function InviteInterceptor.hookInvites()
    pcall(function()
        local RuntimeLib = require(ReplicatedStorage.rbxts_include.RuntimeLib)
        local Remotes = RuntimeLib.import(nil, ReplicatedStorage, "TS", "remotes", "remotes").default
        
        if Remotes and Remotes.Client then
            Remotes.Client:WaitFor("PlayerInvite"):andThen(function(playerInvite)
                print("âœ“ Found PlayerInvite remote")
                
                -- Hook the invite event
                playerInvite:Connect(function(inviteData)
                    print("\nðŸ“¨ INVITE RECEIVED!")
                    print(string.format("  From: %s", inviteData.sender.name))
                    print(string.format("  To: %s", inviteData.receiver and inviteData.receiver.name or "Unknown"))
                    
                    table.insert(InviteInterceptor.invites, {
                        sender = inviteData.sender,
                        receiver = inviteData.receiver,
                        timestamp = tick(),
                        data = inviteData
                    })
                    
                    -- Auto-accept/decline
                    if InviteInterceptor.autoAccept then
                        print("âœ“ Auto-accepting invite...")
                        InviteInterceptor.acceptInvite(inviteData)
                    elseif InviteInterceptor.autoDecline then
                        print("âœ“ Auto-declining invite...")
                        InviteInterceptor.declineInvite(inviteData)
                    end
                end)
                
                print("âœ“ Hooked PlayerInvite event")
            end):catch(function(err)
                warn("Failed to hook PlayerInvite: " .. tostring(err))
            end)
        end
    end)
end

function InviteInterceptor.acceptInvite(inviteData)
    -- Send accept response (implementation depends on how Islands handles accepts)
    print("Accepting invite from: " .. inviteData.sender.name)
    -- TODO: Find the accept remote/method
end

function InviteInterceptor.declineInvite(inviteData)
    -- Send decline response
    print("Declining invite from: " .. inviteData.sender.name)
    -- TODO: Find the decline remote/method
end

function InviteInterceptor.enableAutoAccept()
    InviteInterceptor.autoAccept = true
    InviteInterceptor.autoDecline = false
    print("âœ“ Auto-accept invites enabled")
end

function InviteInterceptor.enableAutoDecline()
    InviteInterceptor.autoAccept = false
    InviteInterceptor.autoDecline = true
    print("âœ“ Auto-decline invites enabled")
end

function InviteInterceptor.disableAuto()
    InviteInterceptor.autoAccept = false
    InviteInterceptor.autoDecline = false
    print("âœ“ Auto invite response disabled")
end

function InviteInterceptor.dumpInvites(count)
    count = count or 10
    print("\n=== Recent Invites ===")
    
    local start = math.max(1, #InviteInterceptor.invites - count + 1)
    for i = start, #InviteInterceptor.invites do
        local invite = InviteInterceptor.invites[i]
        print(string.format("[%d] From: %s (%.1fs ago)", 
            i, invite.sender.name, tick() - invite.timestamp))
    end
end

-- =====================================================
-- INVITE SPAMMER
-- =====================================================

local InviteSpammer = {}
InviteSpammer.enabled = false
InviteSpammer.connection = nil
InviteSpammer.targetPlayer = nil

function InviteSpammer.enable(playerName, delay)
    delay = delay or 1
    
    if InviteSpammer.connection then
        warn("Invite spammer already enabled")
        return
    end
    
    InviteSpammer.enabled = true
    InviteSpammer.targetPlayer = playerName
    
    InviteSpammer.connection = RunService.Heartbeat:Connect(function()
        if not InviteSpammer.enabled then return end
        
        pcall(function()
            -- Send invite to target player
            -- TODO: Find the send invite remote
            print(string.format("ðŸ“¨ Sending invite to %s", playerName))
        end)
        
        task.wait(delay)
    end)
    
    print(string.format("âœ“ Invite spammer enabled (target: %s, %.1fs delay)", playerName, delay))
end

function InviteSpammer.disable()
    InviteSpammer.enabled = false
    if InviteSpammer.connection then
        InviteSpammer.connection:Disconnect()
        InviteSpammer.connection = nil
    end
    print("âœ“ Invite spammer disabled")
end

-- =====================================================
-- SETTINGS BYPASSER
-- =====================================================

local SettingsBypass = {}

function SettingsBypass.enableAllNotifications()
    pcall(function()
        local RuntimeLib = require(ReplicatedStorage.rbxts_include.RuntimeLib)
        local Settings = RuntimeLib.import(nil, ReplicatedStorage, "TS", "settings", "settings")
        
        if Settings and Settings.GetSetting then
            local originalGetSetting = Settings.GetSetting
            
            Settings.GetSetting = function(settingName)
                -- Force enable InviteNotifications
                if settingName == "InviteNotifications" then
                    print("ðŸ”“ Bypassed InviteNotifications setting (forced true)")
                    return true
                end
                
                return originalGetSetting(settingName)
            end
            
            print("âœ“ Hooked GetSetting - notifications enabled")
            return true
        end
    end)
    
    return false
end

-- =====================================================
-- CHAT LOGGER
-- =====================================================

local ChatLogger = {}
ChatLogger.enabled = false
ChatLogger.messages = {}

function ChatLogger.enable()
    ChatLogger.enabled = true
    
    -- Hook chat remotes
    pcall(function()
        local RuntimeLib = require(ReplicatedStorage.rbxts_include.RuntimeLib)
        local Remotes = RuntimeLib.import(nil, ReplicatedStorage, "TS", "remotes", "remotes").default
        
        if Remotes and Remotes.Client then
            -- Look for chat message remotes
            for _, remote in ipairs(Remotes.Client:GetChildren()) do
                if remote.Name:lower():match("chat") or remote.Name:lower():match("message") then
                    remote.OnClientEvent:Connect(function(...)
                        local args = {...}
                        print(string.format("ðŸ’¬ Chat: %s", table.concat(args, " ")))
                        
                        table.insert(ChatLogger.messages, {
                            args = args,
                            timestamp = tick()
                        })
                    end)
                end
            end
        end
    end)
    
    print("âœ“ Chat logger enabled")
end

function ChatLogger.dumpMessages(count)
    count = count or 20
    print("\n=== Recent Chat Messages ===")
    
    local start = math.max(1, #ChatLogger.messages - count + 1)
    for i = start, #ChatLogger.messages do
        local msg = ChatLogger.messages[i]
        print(string.format("[%d] %s (%.1fs ago)", 
            i, table.concat(msg.args, " "), tick() - msg.timestamp))
    end
end

-- =====================================================
-- REMOTE FINDER
-- =====================================================

local RemoteFinder = {}

function RemoteFinder.findChatRemotes()
    print("\n=== Scanning for Chat Remotes ===")
    
    pcall(function()
        local RuntimeLib = require(ReplicatedStorage.rbxts_include.RuntimeLib)
        local Remotes = RuntimeLib.import(nil, ReplicatedStorage, "TS", "remotes", "remotes").default
        
        if Remotes and Remotes.Client then
            print("Scanning Client remotes...")
            
            for _, remote in ipairs(Remotes.Client:GetChildren()) do
                local name = remote.Name
                if name:match("Invite") or name:match("Chat") or name:match("Message") or name:match("Party") then
                    print(string.format("âœ“ Found: %s (%s)", name, remote.ClassName))
                end
            end
        end
        
        if Remotes and Remotes.Server then
            print("Scanning Server remotes...")
            
            for _, remote in ipairs(Remotes.Server:GetChildren()) do
                local name = remote.Name
                if name:match("Invite") or name:match("Chat") or name:match("Message") or name:match("Party") then
                    print(string.format("âœ“ Found: %s (%s)", name, remote.ClassName))
                end
            end
        end
    end)
end

-- =====================================================
-- MAIN EXECUTION
-- =====================================================

print("\n=== Islands Chat Exploiter ===")

-- Initialize
ChatServiceFinder.findChatService()
PlayerListInterceptor.hookFetchPlayers()
InviteInterceptor.hookInvites()
SettingsBypass.enableAllNotifications()
RemoteFinder.findChatRemotes()

print("\n=== Available Commands ===")
print("  PlayerListInterceptor.getPlayers() - Get list of chat players")
print("  PlayerListInterceptor.dumpPlayers() - Show all chat players")
print("  InviteInterceptor.enableAutoAccept() - Auto-accept all invites")
print("  InviteInterceptor.enableAutoDecline() - Auto-decline all invites")
print("  InviteInterceptor.disableAuto() - Disable auto response")
print("  InviteInterceptor.dumpInvites(10) - Show last 10 invites")
print("  InviteSpammer.enable('PlayerName', 1) - Spam invites to player")
print("  InviteSpammer.disable() - Stop spamming")
print("  ChatLogger.enable() - Start logging chat messages")
print("  ChatLogger.dumpMessages(20) - Show last 20 messages")
print("  RemoteFinder.findChatRemotes() - Scan for chat remotes")

print("\nâœ“ Chat exploiter ready")
print("âœ“ All notifications enabled (bypassed settings)")

return {
    ChatServiceFinder = ChatServiceFinder,
    PlayerListInterceptor = PlayerListInterceptor,
    InviteInterceptor = InviteInterceptor,
    InviteSpammer = InviteSpammer,
    SettingsBypass = SettingsBypass,
    ChatLogger = ChatLogger,
    RemoteFinder = RemoteFinder
}
